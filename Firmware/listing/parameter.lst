C51 COMPILER V7.50   PARAMETER                                                             04/04/2016 16:05:20 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE PARAMETER
OBJECT MODULE PLACED IN .\output\parameter.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\parameter.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT
                    -(.\listing\parameter.lst) OBJECT(.\output\parameter.obj)

line level    source

   1          /***************************************************************************/
   2          // 程序：15型座垫机控制系统
   3          // 模块：参数函数
   4          // 文件：parameter.c
   5          // 作者：卜晓D
   6          // 版本：V0.01
   7          // 日期：2016年4月3日
   8          // 功能：主函数
   9          // 芯片：STC12C5A60S2
  10          // 编译：Keil uVision3 V3.90
  11          /***************************************************************************/
  12          
  13          #include <parameter.h>
  14          #include <eeprom.h>
  15          #include <basefunc.h>
  16          
  17          /***************************************************************************/
  18          // 参数定义
  19          /***************************************************************************/
  20          
  21          enum RunMode runMode; //运行模式 0：停止 1：运行
  22          //struct Motor motor1, motor2; //电机
  23          unsigned int motorRotationAngle[6][40]; //电机旋转角 6组数据，每组40个
  24          unsigned char motorCurrentRatationGroup; //当前设置旋转角组
  25          enum DisplayMode displayMode; //刷新屏幕标志位 0 不刷新
  26          
  27          /***************************************************************************/
  28          // 读取参数
  29          // 参数：无
  30          // 返回值：0失败 1成功  
  31          /***************************************************************************/
  32          unsigned char parameter_read()
  33          {
  34   1              unsigned char result = 0,i,j,address;
  35   1              delay_ms(10); 
  36   1              if(IapReadByte(IAP_ADDRESS+511) == 0xEE)
  37   1              {       
  38   2                      for(i=0; i < 6; i++)
  39   2                      {
  40   3                              for(j=0; j < 40; j++)
  41   3                              {
  42   4                                      address = i * 80 + (j<<1);
  43   4                                      motorRotationAngle[i][j] = ((IapReadByte(IAP_ADDRESS + address) << 8) | IapReadByte(IAP_ADDRESS + addr
             -ess + 1));
  44   4                              }
  45   3                      }
  46   2                      result = 1;
  47   2              }
  48   1              return result;
  49   1      }
  50          
  51          /***************************************************************************/
  52          // 参数初始化函数
  53          // 参数：无
C51 COMPILER V7.50   PARAMETER                                                             04/04/2016 16:05:20 PAGE 2   

  54          // 返回值：无   
  55          /***************************************************************************/
  56          void parameter_init()
  57          {
  58   1              unsigned char i,j;
  59   1              if(!parameter_read())
  60   1              {
  61   2                      for(i=0; i < 6; i++)
  62   2                      {
  63   3                              for(j=0; j < 40; j++)
  64   3                              {
  65   4                                      motorRotationAngle[i][j] = 0;
  66   4                              }
  67   3                      }       
  68   2              }
  69   1      }
  70          
  71          /***************************************************************************/
  72          // 参数保存到eeprom
  73          // 参数：无
  74          // 返回值：0失败 1成功  
  75          /***************************************************************************/
  76          unsigned char parameter_save()
  77          {
  78   1              unsigned char i,j,address;
  79   1          delay_ms(10);                      //Delay
  80   1              IapEraseSector(IAP_ADDRESS); //擦除EEPROM
  81   1              for(i=0; i < 6; i++)
  82   1              {
  83   2                      for(j=0; j < 40; j++)
  84   2                      {
  85   3                              address = i * 80 + (j<<1);
  86   3                              IapProgramByte(IAP_ADDRESS + address, (BYTE)(motorRotationAngle[i][j]>>8));
  87   3                              IapProgramByte(IAP_ADDRESS + address+1, (BYTE)(motorRotationAngle[i][j]));
  88   3                      }
  89   2              }
  90   1              IapProgramByte(IAP_ADDRESS+511, 0xEE); //写入标志位
  91   1              return 1;
  92   1      }
  93          
  94          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    390    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    483       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
