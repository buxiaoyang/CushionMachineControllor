C51 COMPILER V7.50   PARAMETER                                                             04/04/2016 19:25:33 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE PARAMETER
OBJECT MODULE PLACED IN .\output\parameter.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\parameter.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT
                    -(.\listing\parameter.lst) OBJECT(.\output\parameter.obj)

line level    source

   1          /***************************************************************************/
   2          // 程序：15型座垫机控制系统
   3          // 模块：参数函数
   4          // 文件：parameter.c
   5          // 作者：卜晓D
   6          // 版本：V0.01
   7          // 日期：2016年4月3日
   8          // 功能：主函数
   9          // 芯片：STC12C5A60S2
  10          // 编译：Keil uVision3 V3.90
  11          /***************************************************************************/
  12          
  13          #include <parameter.h>
  14          #include <eeprom.h>
  15          #include <basefunc.h>
  16          
  17          /***************************************************************************/
  18          // 参数定义
  19          /***************************************************************************/
  20          
  21          enum RunMode runMode; //运行模式 0：停止 1：运行
  22          struct Motor motor1, motor2; //电机
  23          unsigned int motorRotationAngle[6][40]; //电机旋转角 6组数据，每组40个
  24          unsigned char motorCurrentRatationGroup; //当前设置旋转角组
  25          enum DisplayMode displayMode; //刷新屏幕标志位 0 不刷新
  26          
  27          /***************************************************************************/
  28          // 读取参数
  29          // 参数：无
  30          // 返回值：0失败 1成功  
  31          /***************************************************************************/
  32          unsigned char parameter_read()
  33          {
  34   1              WORD result = 0,i,j,address;
  35   1              Delay(10); 
  36   1              if(IapReadByte(IAP_ADDRESS+511) == 0xEE)
  37   1              {       
  38   2                      for(i=0; i < 6; i++)
  39   2                      {
  40   3                              for(j=0; j < 40; j++)
  41   3                              {
  42   4                                      address = i * 80 + (j<<1);
  43   4                                      motorRotationAngle[i][j] = (WORD)((IapReadByte(IAP_ADDRESS + address) << 8) | IapReadByte(IAP_ADDRESS 
             -+ address + 1));
  44   4                              }
  45   3                              
  46   3                      }
  47   2                      result = 1;
  48   2              }
  49   1              return result;
  50   1      }
  51          
  52          /***************************************************************************/
  53          // 参数初始化函数
C51 COMPILER V7.50   PARAMETER                                                             04/04/2016 19:25:33 PAGE 2   

  54          // 参数：无
  55          // 返回值：无   
  56          /***************************************************************************/
  57          void parameter_init()
  58          {       
  59   1              WORD i,j;
  60   1              if(!parameter_read())
  61   1              {
  62   2                      for(i=0; i < 6; i++)
  63   2                      {
  64   3                              for(j=0; j < 40; j++)
  65   3                              {
  66   4                                      motorRotationAngle[i][j] = 0;
  67   4                              }
  68   3                      }       
  69   2              }
  70   1      }
  71          
  72          /***************************************************************************/
  73          // 参数保存到eeprom
  74          // 参数：无
  75          // 返回值：0失败 1成功  
  76          /***************************************************************************/
  77          unsigned char parameter_save()
  78          {
  79   1              WORD result = 1,i,j,address;
  80   1          Delay(10);                     //Delay
  81   1              IapEraseSector(IAP_ADDRESS); //擦除EEPROM
  82   1              Delay(10);  
  83   1              //写入参数
  84   1              for(i=0; i < 6; i++)
  85   1              {
  86   2                      for(j=0; j < 40; j++)
  87   2                      {
  88   3                              address = i * 80 + (j<<1);
  89   3                              IapProgramByte(IAP_ADDRESS + address, (BYTE)(motorRotationAngle[i][j]>>8));
  90   3                              IapProgramByte(IAP_ADDRESS + address+1, (BYTE)(motorRotationAngle[i][j]));
  91   3                      }
  92   2              }
  93   1              IapProgramByte(IAP_ADDRESS+511, 0xEE); //写入标志位
  94   1              Delay(10);
  95   1              //测试写入
  96   1              for(i=0; i < 6; i++)
  97   1              {
  98   2                      for(j=0; j < 40; j++)
  99   2                      {
 100   3                              address = i * 80 + (j<<1);
 101   3                              if(motorRotationAngle[i][j] != (WORD)((IapReadByte(IAP_ADDRESS + address) << 8) | IapReadByte(IAP_ADDRE
             -SS + address + 1)))
 102   3                              {
 103   4                                      result = 0;
 104   4                              }
 105   3                      }
 106   2                      
 107   2              }
 108   1              return result;
 109   1      }
 110          
 111          


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V7.50   PARAMETER                                                             04/04/2016 19:25:33 PAGE 3   

   CODE SIZE        =    846    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    515      16
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
